# Gradle CVE Dependency Check

This is a plugin to be able to run the OWASP CVE Dependency Check in a gradle project.

## Use
You can use and add configuration with cvecheck extension like so:

```
apply plugin: 'dependencycheck'

buildscript {
    repositories {
        mavenCentral()
    }
    dependencies {
        classpath group:'com.danielsomerfield.dependencycheck', name:'gradle-cve-dependency-check', version: '0.3.+'
    }
}
cvecheck {
    refreshAfter = 1000 //The refresh time in seconds
    buildRule {
        buildFailureStrategy = "cvss-overall-threshold"
        threshold = 10
    }  
    buildRule {
        buildFailureStrategy = "cvss-individual-threshold"
        threshold = 6
    }
}
```
The `scan` target runs the CVE check, for example:
`./gradlew --info scan`

## Reporting
The current implementation delegates to the [OWASP Dependency Check library](https://github.com/jeremylong/DependencyCheck).
Here is an example output report from a run in which vulnerabilities were discovered:

![Dependency Report Example](!docs/images/dependency-check-report.jpg)

Right now only the "vulnerability" report is generated from those available via the library. More options will be available soon.

### Configuration Options
- **refreshAfter** *(default: 86400)*: The time after which the plugin goes to the source for new vulnerability 
    information in seconds. The default is one day. If the value is less than or equal to 0, it refresh every time. Note
    that the plugin stores the last check time in ~/.cvecheck/cvecheck-runtime.properties. The underlying scanning library
    stores the database along side the jar file which will usually be in the gradle cache (for example: .gradle/caches/modules-2/files-2.1/org.owasp/dependency-check-utils/1.2.10/bf8927089c924f85a2affc356df0bb660a8083c0/data/cve.2.9.h2.db).
    Deleting either of these files will force a database refresh. Be aware that if you are running in a build pipeline on
    fresh nodes every time and these files are not stored from run to run, there will be overhead as the CVE files download.
    from source.
    
- **buildRule**: a closure that creates a build rule. If this is not specified, two default build rules are added. The default rules
fail the build if the overall CVSS score is greater than 10 or if any individual item is greater than 5. These numbers are highly experimental
and will probably be tweaked in future releases. In the meantime, you probably want to tweak it yourself. The closure currently has
the following properties it can set:
    - buildFailureStrategy = "cvss-individual-threshold" //Currently supported: "cvss-individual-threshold" | cvss-overall-threshold
    - threshold = 6 *(float)*

- **scanResultHandler** *(default: com.danielsomerfield.cvecheck.gradle.handlers.BuildRulesScanResultHandler)*: 
    The handler responsible for translating a scan result into an action (like failing the build.). Default behavior is 
    to fail the build with any detected vulnerability. You only need to change this if you are completed re-writing the 
    rules behind handling results. Otherwise you should just add build rules via the closure.
 
## Status
This project is current functional MVP. You could use the plugin in your project but it is mostly un-configurable. 
Right now, any detected vulnerability of any level will result in a build failure. 

It is a functional MVP. Although I will attempt to maintain backwards compatibility, particularly on patch releases, 
there are no guarantees until the 1.0 release at which point backwards compat will be maintained across major versions.

## Build Status
[![Build Status](https://snap-ci.com/danielsomerfield/gradle-cve-dependency-check/branch/master/build_image)](https://snap-ci.com/danielsomerfield/gradle-cve-dependency-check/branch/master)

## Release notes
- Added refreshAfter so that CVE database is cached for at least the time specified

## Known Issues
- Build
    - Upload archives step is rebuilding the entire project because somehow the gradle history or archives are getting blown away
    - Although it really shouldn't be necessary gradle dependencies required the jar to be signed, which is forcing the need to have the gpg keyring configured.

## RoadMap
- Testing
    - Perf test automation
    - Add stub server for CVE database so E2E tests don't fail when CVE db is down
- Build rules
    - Support for non-failure even with discovered vulns
- Add configuration for
    - CVE data sources
    - subproject aggragation strategy
    - reporting
        - output directory
        - output format
    - CVE Suppression
    - Configurations to run against

## More information
Inspiration for this project comes from the Maven plugin which is part of the OWASP Dependency Check project. More information on that project
is available on [github](https://github.com/jeremylong/DependencyCheck) and the [OWASP website](https://www.owasp.org/index.php/OWASP_Dependency_Check).

## Thank yous
- [OWASP](https://www.owasp.org) for fighting the good fight.
- [Jeremy Long](https://www.owasp.org/index.php/Jeremy_Long) for building the original dependency check.
- [ThoughtWorks' Snap CI](https://www.snap-ci.com/) for providing free continuous integration for open source projects!