# Gradle CVE Dependency Check

This is a plugin to be able to run the OWASP CVE Dependency Check in a gradle project. 

## Configuration
You can use and add configuration with cvecheck extension like so:

```
apply plugin: 'dependencycheck'

buildscript {
    repositories {
        mavenCentral()
    }

    dependencies {
        classpath group:'com.danielsomerfield.dependencycheck', name:'gradle-cve-dependency-check', version: '0.2.+'
    }
}

cvecheck {
    refreshAfter = 1000 //The refresh time in seconds
}
```
### Configuration Options
- **refreshAfter** *(default: 86400)*: The time after which the plugin goes to the source for new vulnerability 
    information in seconds. The default is one day. If the value is less than or equal to 0, it refresh every time. Note
    that the plugin stores the last check time in ~/.cvecheck/cvecheck-runtime.properties. The underlying scanning library
    stores the database along side the jar file which will usually be in the gradle cache (for example: .gradle/caches/modules-2/files-2.1/org.owasp/dependency-check-utils/1.2.10/bf8927089c924f85a2affc356df0bb660a8083c0/data/cve.2.9.h2.db).
    Deleting either of these files will force a database refresh. Be aware that if you are running in a build pipeline on
    fresh nodes every time and these files are not stored from run to run, there will be overhead as the CVE files download.
    from source.
    
- **scanResultHandler** *(default: com.danielsomerfield.cvecheck.gradle.handlers.VulnerabilityCountResultHandler(0)): 
    The handler responsible for translating a scan result into an action (like failing the build.). Default behavior is 
    to fail the build with any detected vulnerability.
    
- **buildRule**: a closure that creates a build rule. If this is not specified, two default build rules are added that 
 
## Status
This project is current functional MVP. You could use the plugin in your project but it is mostly un-configurable. 
Right now, any detected vulnerability of any level will result in a build failure. 

## Build Status
[![Build Status](https://snap-ci.com/danielsomerfield/gradle-cve-dependency-check/branch/master/build_image)](https://snap-ci.com/danielsomerfield/gradle-cve-dependency-check/branch/master)

## Release notes
- Added refreshAfter so that CVE database is cached for at least the time specified

## Known Issues
- Build
    - Upload archives step is rebuilding the entire project because somehow the gradle history or archives are getting blown away
    - Although it really shouldn't be necessary gradle dependencies required the jar to be signed, which is forcing the need to have the gpg keyring configured.

## RoadMap
- Reporting
- Testing
    - Perf test automation
    - Add stub server for CVE database so E2E tests don't fail when CVE db is down
- Add configuration for
    - build failure threshold 
    - CVE data sources
    - subproject aggragation strategy
    - reporting
        - output directory
        - output format
    - CVE Suppression
    - Configurations to run against

## More information
Inspiration for this project comes from the Maven plugin which is part of the OWASP Dependency Check project. More information on that project
is available on [github](https://github.com/jeremylong/DependencyCheck) and the [OWASP website](https://www.owasp.org/index.php/OWASP_Dependency_Check).

## Thank yous
- [OWASP](https://www.owasp.org) for fighting the good fight.
- [Jeremy Long](https://www.owasp.org/index.php/Jeremy_Long) for building the original dependency check.
- [ThoughtWorks' Snap CI](https://www.snap-ci.com/) for providing free continuous integration for open source projects!