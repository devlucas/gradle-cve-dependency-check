package com.danielsomerfield.cvecheck

import com.danielsomerfield.util.FixedTimeSource
import com.danielsomerfield.util.TimeSource
import com.danielsomerfield.util.io.ByteArrayOutputStreamFactory
import com.danielsomerfield.util.io.OutputStreamFactory
import org.hamcrest.CoreMatchers
import org.junit.Test

import static org.junit.Assert.assertThat

class DefaultRuntimeStoreTest {

  private static final TimeSource TIME_SOURCE = new FixedTimeSource(1429745628261)

  @Test
  public void testRefreshCallWritesTime() {
    final OutputStreamFactory outputStreamFactory = new ByteArrayOutputStreamFactory()
    DefaultRuntimeStore store = new DefaultRuntimeStore(outputStreamFactory, TIME_SOURCE);
    store.refreshed()

    Properties resultProperties = new Properties();
    resultProperties.load(new ByteArrayInputStream(outputStreamFactory.toByteArray()))
    assertThat(resultProperties.getProperty("lastRefreshed"), CoreMatchers.is(TIME_SOURCE.currentTimeInMillis().toString()))
  }
}
