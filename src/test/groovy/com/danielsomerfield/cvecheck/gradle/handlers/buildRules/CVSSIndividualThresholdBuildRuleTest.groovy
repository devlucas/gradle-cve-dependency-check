package com.danielsomerfield.cvecheck.gradle.handlers.buildRules

import com.danielsomerfield.cvecheck.ScanResult
import com.danielsomerfield.cvecheck.Vulnerability
import org.junit.Test

import static com.danielsomerfield.util.Maybe.some
import static org.hamcrest.CoreMatchers.is
import static org.junit.Assert.assertThat

class CVSSIndividualThresholdBuildRuleTest {
  @Test
  public void testPassesIfAllAreUnderThreshold() {
    RuleOutcome outcome = new CVSSIndividualThresholdBuildRule(new BuildRuleConfiguration(some(5))).execute(new ScanResult() {
      public List<Vulnerability> getVulnerabilities() {
        [
            new MockVulnerability(2),
            new MockVulnerability(2)
        ]
      }
    })
    assertThat(outcome, is(RuleOutcome.Passed))
  }

  @Test
  public void testFailsIfOverThreshold() {
    RuleOutcome buildOutcome = new CVSSIndividualThresholdBuildRule(new BuildRuleConfiguration(some(2))).execute(new ScanResult() {
      public List<Vulnerability> getVulnerabilities() {
        [new MockVulnerability(3),
         new MockVulnerability(2)]
      }
    })
    assertThat(buildOutcome, is(RuleOutcome.Failed))
  }
}
