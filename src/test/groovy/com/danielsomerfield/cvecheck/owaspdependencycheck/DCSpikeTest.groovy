package com.danielsomerfield.cvecheck.owaspdependencycheck

import org.junit.Test
import org.owasp.dependencycheck.Engine
import org.owasp.dependencycheck.dependency.Dependency
import org.owasp.dependencycheck.utils.Settings

class DCSpikeTest {

  @Test
  public void runTest() {

    final String applicationName = "fooApp";

    Settings.initialize()
    Settings.setBoolean(Settings.KEYS.AUTO_UPDATE, false);
    Engine engine = new Engine();
//        engine.scan(new File("build/libs/gradle-cve-dependency-check-0.1.0-DEV.jar"))
    engine.scan(new File("/Users/danielsomerfield/gap_workspace/cmf/build/target/ivy/repo-cache/springframework/spring-core/jars/spring-core-3.1.4.jar"))
    engine.analyzeDependencies()

    engine.getDependencies().collect { Dependency dependency ->
      dependency.getVulnerabilities()
    }.flatten().each{println(it.dump())}

//        CveDB cveDB = new CveDB();
//        final ReportGenerator reportGenerator = new ReportGenerator(
//                applicationName,
//                engine.getDependencies(),
//                engine.getAnalyzers(),
//                cveDB.databaseProperties)
//        reportGenerator.generateReports(System.out, ReportGenerator.Format.XML)
  }

}
