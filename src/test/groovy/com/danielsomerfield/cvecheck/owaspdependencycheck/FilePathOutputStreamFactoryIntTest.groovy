package com.danielsomerfield.cvecheck.owaspdependencycheck

import com.danielsomerfield.util.io.FilePathOutputStreamFactory
import org.junit.After
import org.junit.Assert
import org.junit.Test

import static org.apache.commons.io.IOUtils.toString
import static org.hamcrest.CoreMatchers.is

class FilePathOutputStreamFactoryIntTest {

  private String filePath;

  @After
  public void tearDown(){
    new File(filePath).delete()
  }

  @Test
  public void testCreateFile(){
    filePath = "/tmp/" + UUID.randomUUID().toString();
    String message = String.valueOf(System.currentTimeMillis());
    new FilePathOutputStreamFactory(filePath).outputStream.withCloseable { OutputStream out ->
      out.write(message.getBytes("UTF-8"))
    }
    Assert.assertThat(toString(new FileInputStream(filePath)), is(message))
  }

  @Test
  public void testCreateFileWithNoParent(){
    filePath = "/tmp/" + UUID.randomUUID().toString() + "/mkdirs-test";
    String message = String.valueOf(System.currentTimeMillis());
    new FilePathOutputStreamFactory(filePath).outputStream.withCloseable { OutputStream out ->
      out.write(message.getBytes("UTF-8"))
    }
    Assert.assertThat(toString(new FileInputStream(filePath)), is(message))
  }
}
