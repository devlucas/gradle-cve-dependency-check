package org.owasp.dependencycheck.gradle

import org.gradle.api.Project
import org.gradle.api.artifacts.Configuration
import org.gradle.api.artifacts.ConfigurationContainer
import org.gradle.api.artifacts.ResolvedArtifact
import org.gradle.api.artifacts.ResolvedConfiguration
import org.junit.Test

import static org.hamcrest.CoreMatchers.is
import static org.junit.Assert.assertThat
import static org.owasp.dependencycheck.gradle.GradleProjects.getFilesForProject

class GradleProjectsTest {

  @Test
  public void testExtractFilesFromProject() {
    def resolvedConfig = [
        getResolvedArtifacts: {
          [
              [
                  getFile: {new File("asdf")}
              ] as ResolvedArtifact
          ] as Set
        }
    ] as ResolvedConfiguration

    def configs = [[
        getResolvedConfiguration: { resolvedConfig }
    ] as Configuration] as Set

    def project = [
        getConfigurations: {
          [
              findAll: { c ->
                configs.collect { c(it) } as Set
              }
          ] as ConfigurationContainer
        }
    ] as Project

    final Set<File> set = getFilesForProject(project);
    assertThat(set.size(), is(1))
    assertThat(set.toArray()[0].getName(), is("asdf"))
  }
}
