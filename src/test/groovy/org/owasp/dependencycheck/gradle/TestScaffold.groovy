package org.owasp.dependencycheck.gradle

import org.owasp.dependencycheck.Engine
import org.owasp.dependencycheck.dependency.Dependency
import org.owasp.dependencycheck.dependency.Vulnerability
import org.owasp.dependencycheck.utils.Settings

class TestScaffold {
  def static Engine mockEngine(Closure depToVulnFunction) {
    Settings.initialize()

    List<Dependency> dependencies = []

    return [
        getDependencies : {
          dependencies
        },
        scan: {File f -> dependencies.add(new Dependency(f)); dependencies},
        analyzeDependencies: {
          dependencies.each { Dependency dependency ->
            depToVulnFunction(dependency)
          }
        }
    ] as Engine
  }

  static def Vulnerability createVulnerability(String name) {
    def vulnerability = new Vulnerability()
    vulnerability.setName(name)
    vulnerability
  }

}
