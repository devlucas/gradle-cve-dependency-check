package org.owasp.dependencycheck.gradle

import org.gradle.api.GradleException
import org.gradle.api.Plugin
import org.gradle.api.Project

class DependencyCheckGradlePlugin implements Plugin<Project> {
  @Override
  void apply(final Project project) {
    project.getTasks().create("scan") << {
      def scanResult = new GradleProjectScanner().scan(project)
      if (scanResult.vulnCount > 0) {
        logger.info("Detected vulns.")
        throw new GradleException("${scanResult.vulnCount} vulnerabilities were detected")
      } else {
        logger.info("No vulnerabilities detected.")
      }
    }
  }
}
