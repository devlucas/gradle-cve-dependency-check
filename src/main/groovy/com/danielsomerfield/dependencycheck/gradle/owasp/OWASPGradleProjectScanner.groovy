package com.danielsomerfield.dependencycheck.gradle.owasp

import com.danielsomerfield.dependencycheck.gradle.FileVulnerabilities
import com.danielsomerfield.dependencycheck.gradle.GradleProjectScanner
import com.danielsomerfield.dependencycheck.gradle.GradleProjects
import com.danielsomerfield.dependencycheck.gradle.ScanResult
import org.gradle.api.Project
import org.owasp.dependencycheck.Engine
import org.owasp.dependencycheck.utils.Settings

class OWASPGradleProjectScanner implements GradleProjectScanner {

  private Engine engine;

  public OWASPGradleProjectScanner(Engine engine) {
    this.engine = engine;
  }

  public OWASPGradleProjectScanner(){
    Settings.initialize()
    this.engine = new Engine()
  }

  public ScanResult scan(final Project project) {
    new ScanResult(FileVulnerabilities.getVulnerabilitiesForFiles(this.engine, GradleProjects.getFilesForProject(project)))
  }
}
