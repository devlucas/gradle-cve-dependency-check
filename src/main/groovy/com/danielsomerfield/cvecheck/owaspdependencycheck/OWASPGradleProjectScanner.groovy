package com.danielsomerfield.cvecheck.owaspdependencycheck
import com.danielsomerfield.cvecheck.ScanResult
import com.danielsomerfield.cvecheck.ScanningEngineSourceUpdate
import com.danielsomerfield.cvecheck.gradle.GradleProjectScanner
import com.danielsomerfield.cvecheck.reporting.ScanReportGenerator
import org.gradle.api.Project

class OWASPGradleProjectScanner implements GradleProjectScanner {

  private final ScanReportGenerator<OWASPScanResult> scanReportGenerator;
  private final ScanningEngine<OWASPScanResult> scanningEngine;
  private final ScanningEngineSourceUpdate scanningEngineSourceUpdate;

  public OWASPGradleProjectScanner(
      ScanReportGenerator<OWASPScanResult> scanReportGenerator,
      ScanningEngine<OWASPScanResult> scanResultCreator,
      ScanningEngineSourceUpdate scanningEngineSourceUpdate
  ) {
    this.scanReportGenerator = scanReportGenerator
    this.scanningEngine = scanResultCreator
    this.scanningEngineSourceUpdate = scanningEngineSourceUpdate
  }

  public ScanResult scan(final Project project) {
    scanningEngineSourceUpdate.run(scanningEngine)
    final OWASPScanResult result = scanningEngine.createScanResult(project)
    scanReportGenerator.generateReport(result)
    result
  }
}


