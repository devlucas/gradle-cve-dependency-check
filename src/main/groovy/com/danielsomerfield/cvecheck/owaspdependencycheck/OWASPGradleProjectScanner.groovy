package com.danielsomerfield.cvecheck.owaspdependencycheck

import com.danielsomerfield.cvecheck.ScanResult
import com.danielsomerfield.cvecheck.gradle.GradleProjectScanner
import com.danielsomerfield.cvecheck.reporting.ScanReportGenerator
import org.gradle.api.Project
import org.owasp.dependencycheck.Engine

import static com.danielsomerfield.cvecheck.FileVulnerabilities.getVulnerabilitiesForFiles
import static com.danielsomerfield.cvecheck.gradle.GradleProjects.getFilesForProject

class OWASPGradleProjectScanner implements GradleProjectScanner {

  private Engine engine;
  private ScanReportGenerator<OWASPScanResult> scanReportGenerator;
  //TODO: remove static getFilesForProject with delegate

  public OWASPGradleProjectScanner(Engine engine, ScanReportGenerator<OWASPScanResult> scanReportGenerator) {
    this.engine = engine;
    this.scanReportGenerator = scanReportGenerator;
  }

  public ScanResult scan(final Project project) {
    final OWASPScanResult result = new OWASPScanResult(
        getVulnerabilitiesForFiles(this.engine, getFilesForProject(project)))
    this.scanReportGenerator.generateReport(result)
    result
  }
}


