package com.danielsomerfield.cvecheck.owaspdependencycheck

import com.danielsomerfield.cvecheck.FileVulnerabilities
import com.danielsomerfield.cvecheck.gradle.GradleProjectScanner
import com.danielsomerfield.cvecheck.gradle.GradleProjects
import com.danielsomerfield.cvecheck.ScanResult
import org.gradle.api.Project
import org.owasp.dependencycheck.Engine
import org.owasp.dependencycheck.utils.Settings

class OWASPGradleProjectScanner implements GradleProjectScanner {

  private Engine engine;

  public OWASPGradleProjectScanner(Engine engine) {
    this.engine = engine;
  }

  public OWASPGradleProjectScanner(){
    Settings.initialize()
    this.engine = new Engine()
  }

  public ScanResult scan(final Project project) {
    new OWASPScanResult(FileVulnerabilities.getVulnerabilitiesForFiles(this.engine, GradleProjects.getFilesForProject(project)))
  }
}
