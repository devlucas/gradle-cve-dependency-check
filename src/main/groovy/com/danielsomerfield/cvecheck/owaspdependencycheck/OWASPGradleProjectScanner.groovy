package com.danielsomerfield.cvecheck.owaspdependencycheck

import com.danielsomerfield.cvecheck.FileVulnerabilities
import com.danielsomerfield.cvecheck.gradle.GradleProjectScanner
import com.danielsomerfield.cvecheck.gradle.GradleProjects
import com.danielsomerfield.cvecheck.ScanResult
import com.danielsomerfield.cvecheck.reporting.ScanReportGenerator
import org.gradle.api.Project
import org.owasp.dependencycheck.Engine
import org.owasp.dependencycheck.utils.Settings

class OWASPGradleProjectScanner implements GradleProjectScanner {

  private Engine engine;
  private ScanReportGenerator scanReportGenerator;

  public OWASPGradleProjectScanner(Engine engine, ScanReportGenerator scanReportGenerator) {
    this.engine = engine;
    this.scanReportGenerator = scanReportGenerator;
  }

  public ScanResult scan(final Project project) {
    def result = new OWASPScanResult(FileVulnerabilities.getVulnerabilitiesForFiles(this.engine, GradleProjects.getFilesForProject(project)))
    this.scanReportGenerator.generateReport()
    result
  }
}
