package com.danielsomerfield.cvecheck.gradle.handlers

import com.danielsomerfield.cvecheck.ScanResult
import com.danielsomerfield.cvecheck.ScanResultHandler
import com.danielsomerfield.cvecheck.gradle.handlers.buildRules.BuildRule
import com.danielsomerfield.cvecheck.gradle.handlers.buildRules.BuildRules
import com.danielsomerfield.cvecheck.gradle.handlers.buildRules.RuleOutcome
import org.gradle.api.GradleException

class BuildRulesScanResultHandler implements ScanResultHandler {

  private final BuildRules buildRules

  BuildRulesScanResultHandler(final BuildRules buildRules) {
    this.buildRules = buildRules
  }

  @Override
  void handleScanResult(final ScanResult scanResult) {
    List<String> failures = []
    buildRules.each { BuildRule rule -> if (rule.execute(scanResult) == RuleOutcome.Failed) failures.add(rule.name) }
    if (failures.size() > 0) {
      throw new GradleException("The following rules failed: ${failures}")
    }
  }

}
