package com.danielsomerfield.cvecheck.gradle.handlers.buildRules

import com.danielsomerfield.util.Maybe

import static com.danielsomerfield.util.Maybe.some

class CVEBuildRuleBuilder implements BuildRuleBuilder {

  private String buildFailureStrategy;
  private int threshold;
  private Map<String, Class<? extends BuildRule>> buildRuleTypes;

  CVEBuildRuleBuilder(final Map<String, Class<? extends BuildRule>> buildRuleTypes) {
    this.buildRuleTypes = buildRuleTypes
  }

  @Override
  Maybe<BuildRule> create() {
    some(buildRuleTypes.get(buildFailureStrategy)).map { Class<? extends BuildRule> clazz -> clazz.newInstance() }
  }

  @Override
  CVEBuildRuleBuilder setBuildFailureStrategy(final String buildFailureStrategy) {
    this.buildFailureStrategy = buildFailureStrategy;
    this
  }

  @Override
  CVEBuildRuleBuilder setThreshold(final int threshold) {
    this.threshold = threshold
    this
  }
}
