package com.danielsomerfield.cvecheck.gradle

import com.danielsomerfield.cvecheck.ScanResultHandler
import com.danielsomerfield.cvecheck.gradle.handlers.VulnerabilityCountResultHandler
import com.danielsomerfield.cvecheck.gradle.handlers.buildRules.BuildRule
import com.danielsomerfield.cvecheck.gradle.handlers.buildRules.BuildRuleBuilder

class CVECheckExtension {

  private BuildRuleBuilder buildRuleBuilder;

  CVECheckExtension(final BuildRuleBuilder buildRuleBuilder = new BuildRuleBuilder()) {
    this.buildRuleBuilder = buildRuleBuilder
  }

  def long refreshAfter = 86400 /** Seconds **/
  private List<BuildRule> buildRules = []
//  def ScanResultHandler scanResultHandler = new BuildRulesScanResultHandler(buildRules);
  def ScanResultHandler scanResultHandler = new VulnerabilityCountResultHandler(0)

  def buildRule(Closure ruleConfigClosure) {
    ruleConfigClosure.resolveStrategy = Closure.DELEGATE_FIRST
    ruleConfigClosure.delegate = buildRuleBuilder
    ruleConfigClosure()
    buildRules.add(buildRuleBuilder.create())
  }
}
