package com.danielsomerfield.cvecheck.gradle

import com.danielsomerfield.cvecheck.reporting.ScanReportGenerator
import org.gradle.api.GradleException
import org.gradle.api.Project

class ScanTask {

  private final GradleProjectScanner scanner
  private final ScanReportGenerator scanReportGenerator

  public ScanTask(final GradleProjectScanner scanner, ScanReportGenerator scanReportGenerator) {
    this.scanner = scanner;
    this.scanReportGenerator = scanReportGenerator
  }

  def scan(Project project) {
    def scanResult = scanner.scan(project)
    if (scanResult.vulnCount > 0) {
      project.logger.info("Detected vulns.")
      throw new GradleException("${scanResult.vulnCount} vulnerabilities were detected")
    } else {
      project.logger.info("No vulnerabilities detected.")
    }
  }
}
