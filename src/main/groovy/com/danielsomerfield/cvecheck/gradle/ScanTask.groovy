package com.danielsomerfield.cvecheck.gradle

import org.gradle.api.GradleException
import org.gradle.api.Project
import org.slf4j.Logger
import org.slf4j.LoggerFactory

class ScanTask {

  private final GradleProjectScanner scanner
  private final Logger logger = LoggerFactory.getLogger(this.getClass())

  public ScanTask(final GradleProjectScanner scanner) {
    this.scanner = scanner;
  }

  def scan(Project project) {
    def scanResult = scanner.scan(project)
    if (scanResult.vulnCount > 0) {
      logger.info("Detected vulns!")
      throw new GradleException("${scanResult.vulnCount} vulnerabilities were detected")
    } else {
      logger.info("No vulnerabilities detected.")
    }
  }
}
