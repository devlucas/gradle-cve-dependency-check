package com.danielsomerfield.cvecheck

import com.danielsomerfield.util.Maybe
import com.danielsomerfield.util.TimeSource
import com.danielsomerfield.util.io.OutputStreamFactory

class DefaultRuntimeStore implements RuntimeStore {
  private OutputStreamFactory outputStreamFactory;
  private TimeSource timeSource;
  private Properties backingProperties = new Properties();

  DefaultRuntimeStore(final OutputStreamFactory outputStreamFactory, final TimeSource timeSource) {
    this.outputStreamFactory = outputStreamFactory
    this.timeSource = timeSource
  }

  @Override
  def Maybe<Long> lastRefreshed(){

  }

  @Override
  def void refreshed(){
    backingProperties.setProperty("lastRefreshed", timeSource.currentTimeInMillis().toString());

    outputStreamFactory.outputStream.withCloseable {OutputStream out ->
      backingProperties.store(out, "Runtime store for CVE Check")
    }
  }
}
